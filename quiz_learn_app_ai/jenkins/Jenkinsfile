pipeline {
    agent {
        docker {
            image 'cirrusci/flutter:latest' // A Docker image that includes both Flutter and the Android SDK
            args '-u root:root' // Run as root user to install Android SDK packages
        }
    }
    environment {
        ANDROID_HOME = "/opt/android-sdk"
        PATH = "$PATH:$ANDROID_HOME/cmdline-tools/latest/bin:$ANDROID_HOME/platform-tools:$ANDROID_HOME/emulator:$ANDROID_HOME/tools:$ANDROID_HOME/tools/bin"
    }
    stages {
        stage('Checkout SCM') {
            steps {
                git credentialsId: '58d656b9-abba-4fb4-8eea-a1cc309cf805', url: 'https://github.com/BS-PMC-2024/BS-PMC-2024-Team18.git'
            }
        }
        stage('Setup Android SDK') {
            steps {
                sh '''
                yes | sdkmanager --licenses
                sdkmanager "platform-tools" "platforms;android-30" "build-tools;30.0.3"
                '''
            }
        }
        stage('Build Flutter App') {
            steps {
                dir('quiz_learn_app_ai') {
                    sh '''
                    flutter pub get
                    flutter build apk
                    '''
                }
            }
        }
    }
}
